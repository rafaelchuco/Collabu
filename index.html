<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Collabu - Plataforma Centralizada para Estudiantes de Educacion Superior</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* Reset y estilos base mejorados */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      /* Fondo base con gradiente vibrante */
      background: linear-gradient(to bottom, #6e45e2, #88d3ce);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      font-family: 'Poppins', sans-serif;
      position: relative;
    }
    
    /* Fondo tecnológico dinámico */
    .tech-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* Imagen de fondo sutil con temática tecnológica */
      background: url('https://images.unsplash.com/photo-1620712943543-bcc4688e7485?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80') no-repeat center center;
      background-size: cover;
      opacity: 0.1; /* Opacidad baja para no saturar */
      z-index: -1;
    }

    /* Nuevo fondo temático estudiantil para secciones internas */
    .student-theme-bg {
      position: absolute; /* Para superponerse dentro de la sección */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80') no-repeat center center;
      background-size: cover;
      opacity: 0.15; /* Sutil opacidad para que no abruma */
      z-index: -1; /* Detrás del contenido de la sección */
      border-radius: 16px; /* Para que coincida con el borde de la sección */
      background-blend-mode: multiply; /* Para fusionarse con el color de fondo */
    }
    
    /* Hero image */
    .hero-image {
      width: 100%;
      max-height: 280px;
      overflow: hidden;
      border-bottom: 5px solid #fff;
      position: relative;
    }
    .hero-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }
    .hero-image:hover img {
      transform: scale(1.05);
    }
    
    /* Logo moderno */
    .logo-container {
      text-align: center;
      margin: 1.5rem 0;
      position: relative;
      z-index: 1;
    }
    .logo {
      font-size: 2.5rem;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .logo i {
      margin-right: 0.5rem;
    }
    .logo-subtitle {
      color: white;
      font-size: 1.1rem;
      margin-top: 0.5rem;
      text-shadow: 0 1px 5px rgba(0,0,0,0.2);
    }
    
    /* Header mejorado */
    header {
      background: rgba(110, 69, 226, 0.9);
      color: white;
      padding: 1rem 2rem;
      text-align: center;
      font-weight: 700;
      font-size: 2rem;
      letter-spacing: 1px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      position: relative;
      z-index: 2;
    }
    
    /* Barra de navegación mejorada */
    nav {
      background: rgba(125, 95, 255, 0.9);
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 0.8rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      position: relative;
      z-index: 2;
    }
    nav button {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.6rem 1.2rem;
      border-radius: 25px;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    nav button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    nav button:hover::before {
      left: 100%;
    }
    nav button:hover, nav button.active {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    nav button.logout-button {
      margin-left: auto;
      background: #4a2db5;
    }
    nav button.logout-button:hover {
      background: #3a1da5;
    }
    
    /* Contenido principal */
    main {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      padding: 2rem;
      /* Fondo semi-transparente para ver el tech-bg, con un toque azulado */
      background: rgba(241, 243, 249, 0.7); 
      position: relative;
      z-index: 1;
    }
    
    /* Secciones mejoradas */
    section {
      display: none;
      max-width: 900px;
      width: 100%;
      /* Fondo base con transparencia y blur */
      background-color: rgba(245, 247, 255, 0.9); /* Azul muy pálido con más transparencia */
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      padding: 2rem;
      overflow-y: auto;
      max-height: 70vh;
      position: relative;
      backdrop-filter: blur(8px); /* Aumento del blur */
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.3); /* Borde sutil para el efecto de vidrio */
    }
    section.active {
      display: block;
      animation: fadeIn 0.4s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Títulos */
    h2 {
      color: #6e45e2;
      margin-bottom: 1.5rem;
      font-weight: 600;
      position: relative;
      padding-bottom: 0.5rem;
    }
    h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 3px;
      background: linear-gradient(to right, #6e45e2, #88d3ce);
      border-radius: 3px;
    }
    
    /* Tarjetas mejoradas */
    .card-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }
    .card {
      /* Fondo con transparencia y blur, usando el matiz azulado */
      background: rgba(245, 247, 255, 0.9); /* Más opaco para contenido */
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      border-left: 5px solid #7d5fff;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(110,69,226,0.05) 0%, rgba(136,211,206,0.05) 100%); /* Menos opaco */
      z-index: 0;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }
    .card h3 {
      color: #4a2db5;
      margin-bottom: 0.8rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      z-index: 1;
    }
    .card h3 i {
      font-size: 1.2rem;
    }
    .card p {
      color: #555;
      font-size: 0.95rem;
      line-height: 1.5;
      position: relative;
      z-index: 1;
    }
    
    /* Formularios mejorados */
    .form-container {
      /* Fondo con transparencia y blur, con el matiz azulado */
      background-color: rgba(245, 247, 255, 0.95);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      padding: 2.5rem;
      max-width: 450px;
      width: 100%;
      margin: 2rem auto;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.3);
    }

    .form-container .student-theme-bg {
      border-radius: 16px; /* Asegura que la imagen de fondo se recorte con el contenedor */
    }

    label {
      font-weight: 500;
      color: #555;
      margin-bottom: 0.5rem;
      display: block;
    }
    input[type="text"], 
    input[type="password"], 
    textarea,
    select,
    input[type="email"],
    input[type="file"] {
      padding: 0.9rem 1.2rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s;
      width: 100%;
      font-family: 'Poppins', sans-serif;
      background: rgba(255,255,255,0.8); /* Campos de entrada ligeramente blancos */
    }
    input[type="text"]:focus, 
    input[type="password"]:focus, 
    textarea:focus,
    select:focus,
    input[type="email"]:focus,
    input[type="file"]:focus {
      border-color: #6e45e2;
      outline: none;
      box-shadow: 0 0 0 3px rgba(110, 69, 226, 0.2);
    }
    
    /* Botones mejorados */
    button.btn-primary {
      background: linear-gradient(135deg, #6e45e2 0%, #88d3ce 100%);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    button.btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: 0.5s;
    }
    button.btn-primary:hover::before {
      left: 100%;
    }
    button.btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(110, 69, 226, 0.3);
    }
    
    /* Mensajes */
    #error-message,
    #register-error-message {
      color: #ff4757;
      font-weight: 500;
      text-align: center;
      margin-top: 1rem;
      padding: 0.8rem;
      background: rgba(255, 71, 87, 0.1);
      border-radius: 8px;
    }
    #success-message {
      color: #2ed573;
      font-weight: 500;
      text-align: center;
      margin-top: 1rem;
      padding: 0.8rem;
      background: rgba(46, 213, 115, 0.1);
      border-radius: 8px;
    }
    
    /* Ocultar contenido principal hasta login */
    #main-content.hidden {
      display: none;
    }
    
    /* Links para cambiar formulario */
    .form-link {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: #6e45e2;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .form-link:hover {
      color: #4a2db5;
      text-decoration: underline;
    }
    .form-link strong {
      font-weight: 600;
    }
    
    /* Notas mejoradas */
    .notes-container {
      margin-top: 2rem;
    }
    .notes-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    .note-card {
      background: rgba(245, 247, 255, 0.9); /* Usando el matiz azulado */
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-left: 4px solid #7d5fff;
      position: relative;
      transition: transform 0.3s;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .note-card:hover {
      transform: translateY(-3px);
    }
    .note-card h4 {
      color: #4a2db5;
      margin-bottom: 0.8rem;
      font-size: 1.1rem;
    }
    .note-card p {
      margin-bottom: 0.8rem;
      color: #555;
      line-height: 1.5;
    }
    .note-card .note-date {
      font-size: 0.8rem;
      color: #888;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .note-card .delete-note {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: #ff4757;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .note-card .delete-note:hover {
      background: #e84118;
    }
    .note-form {
      margin-top: 1.5rem;
      background: rgba(245, 247, 255, 0.8); /* Más transparencia, usando el matiz azulado */
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .note-form h3 {
      color: #4a2db5;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .note-form textarea {
      width: 100%;
      min-height: 120px;
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
      background: rgba(255,255,255,0.9); /* Ligeramente blanco */
    }
    
    /* Selector de universidad mejorado */
    .university-selector {
      margin-top: 1rem;
    }
    .university-selector select {
      width: 100%;
      padding: 0.9rem 1.2rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      margin-bottom: 1rem;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1em;
      background-color: rgba(255,255,255,0.9); /* Ligeramente blanco */
    }
    
    /* Filtro de universidad */
    .university-filter {
      margin: 1.5rem 0;
      padding: 1.5rem;
      background: rgba(245, 247, 255, 0.8); /* Más transparencia, usando el matiz azulado */
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .university-filter select {
      width: 100%;
      max-width: 300px;
      padding: 0.8rem 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      background: rgba(255,255,255,0.9); /* Ligeramente blanco */
    }
    
    /* Tarjetas interinstitucionales */
    .interclub-card {
      position: relative;
      padding-bottom: 1rem;
    }
    .interclub-card .university-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: #6e45e2;
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    /* Sistema de chat mejorado */
    .chat-container {
      display: flex;
      height: 500px;
      border: 1px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
      margin-top: 1.5rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      background: rgba(245, 247, 255, 0.9); /* Usando el matiz azulado */
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .chat-sidebar {
      width: 280px;
      background: rgba(230, 235, 250, 0.9); /* Más oscuro para diferenciar, azulado */
      border-right: 1px solid #ddd;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .chat-main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      background: rgba(255,255,255,0.95);
    }
    .chat-header {
      padding: 1.2rem;
      background: #6e45e2;
      color: white;
      font-weight: 600;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .chat-messages {
      flex-grow: 1;
      padding: 1.5rem;
      overflow-y: auto;
      background: rgba(255,255,255,0.95); /* Fondo de mensajes, ligeramente blanco */
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .message {
      max-width: 75%;
      padding: 0.9rem 1.2rem;
      border-radius: 12px;
      position: relative;
      animation: messageIn 0.3s ease;
    }
    @keyframes messageIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .message.sent {
      background: rgba(230, 247, 255, 0.9); /* Mensajes enviados, azul muy claro */
      margin-left: auto;
      border-bottom-right-radius: 0;
    }
    .message.received {
      background: rgba(245, 245, 245, 0.9); /* Mensajes recibidos, gris muy claro */
      margin-right: auto;
      border-bottom-left-radius: 0;
    }
    .message-sender {
      font-weight: 600;
      font-size: 0.85rem;
      color: #6e45e2;
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .message-time {
      font-size: 0.75rem;
      color: #888;
      text-align: right;
      margin-top: 0.5rem;
    }
    .chat-input {
      display: flex;
      padding: 1rem;
      background: rgba(245, 247, 255, 0.9); /* Usando el matiz azulado */
      border-top: 1px solid #ddd;
      gap: 0.5rem;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .chat-input input {
      flex-grow: 1;
      padding: 0.8rem 1.2rem;
      border: 1px solid #ddd;
      border-radius: 20px;
      font-size: 1rem;
      transition: border-color 0.3s;
      background: rgba(255,255,255,0.9); /* Ligeramente blanco */
    }
    .chat-input input:focus {
      border-color: #6e45e2;
      outline: none;
    }
    .chat-input button {
      background: #6e45e2;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 0 1.5rem;
      cursor: pointer;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .chat-input button:hover {
      background: #5a36c7;
    }
    .chat-contacts {
      flex-grow: 1;
      overflow-y: auto;
    }
    .chat-contact {
      padding: 1rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      background: rgba(255,255,255,0.8); /* Ligeramente blanco */
    }
    .chat-contact:hover {
      background: rgba(230, 247, 255, 0.9); /* Azul muy claro al hover */
    }
    .chat-contact.active {
      background: #6e45e2;
      color: white;
    }
    .chat-tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      background: rgba(245, 247, 255, 0.9); /* Usando el matiz azulado */
    }
    .chat-tab {
      flex: 1;
      text-align: center;
      padding: 1rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .chat-tab.active {
      background: #6e45e2;
      color: white;
    }
    
    /* Llamadas */
    .call-container {
      display: flex;
      flex-direction: column;
      height: 500px;
      border: 1px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
      margin-top: 1.5rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      background: rgba(245, 247, 255, 0.9); /* Usando el matiz azulado */
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .call-header {
      padding: 1.2rem;
      background: #6e45e2;
      color: white;
      font-weight: 600;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .call-video {
      flex-grow: 1;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .call-video video {
      max-width: 100%;
      max-height: 100%;
    }
    .call-controls {
      display: flex;
      justify-content: center;
      padding: 1rem;
      background: rgba(245, 247, 255, 0.9); /* Usando el matiz azulado */
      border-top: 1px solid #ddd;
      gap: 1rem;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .call-controls button {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: #6e45e2;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    .call-controls button:hover {
      transform: scale(1.1);
    }
    .call-controls button.end-call {
      background: #ff4757;
    }
    
    /* Perfil mejorado */
    .profile-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .profile-header {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .profile-avatar {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      overflow: hidden;
      cursor: pointer;
      border: 3px solid #6e45e2;
      box-shadow: 0 4px 15px rgba(110,69,226,0.3);
    }
    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .profile-avatar .change-avatar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7);
      color: white;
      text-align: center;
      padding: 0.5rem;
      font-size: 0.8rem;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .profile-avatar:hover .change-avatar {
      opacity: 1;
    }
    .profile-info {
      flex-grow: 1;
    }
    .profile-name {
      color: #4a2db5;
      margin-bottom: 0.5rem;
      font-size: 1.5rem;
      font-weight: 600;
    }
    .profile-university {
      color: #555;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .profile-edit {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .profile-edit button {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: none;
      background: #6e45e2;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }
    .profile-edit button:hover {
      background: #5a36c7;
    }
    .profile-section {
      background: rgba(245, 247, 255, 0.8); /* Usando el matiz azulado */
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .profile-section h3 {
      color: #4a2db5;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* Avatar selector */
    .avatar-selector {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    .avatar-selector.active {
      opacity: 1;
      visibility: visible;
    }
    .avatar-selector-content {
      background: rgba(245, 247, 255, 0.95); /* Usando el matiz azulado */
      padding: 2rem;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      backdrop-filter: blur(10px); /* Más blur para el modal */
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.5);
    }
    .avatar-selector-title {
      color: #4a2db5;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .avatar-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .avatar-option {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .avatar-option:hover {
      transform: scale(1.05);
      border-color: #6e45e2;
    }
    .avatar-option.selected {
      border-color: #6e45e2;
      box-shadow: 0 0 0 3px rgba(110,69,226,0.3);
    }
    .avatar-option img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .avatar-selector-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .avatar-selector-buttons button {
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }
    .avatar-selector-buttons button.confirm {
      background: #6e45e2;
      color: white;
    }
    .avatar-selector-buttons button.confirm:hover {
      background: #5a36c7;
    }
    .avatar-selector-buttons button.cancel {
      background: #f5f5f5;
      color: #555;
    }
    .avatar-selector-buttons button.cancel:hover {
      background: #e5e5e5;
    }
    
    /* Barra de menú lateral */
    .sidebar {
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100vh;
      background: rgba(245, 247, 255, 0.95); /* Usando el matiz azulado */
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      z-index: 1000;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(10px); /* Más blur para el sidebar */
      -webkit-backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255,255,255,0.5);
    }
    .sidebar.active {
      left: 0;
    }
    .sidebar-header {
      padding: 1.5rem;
      background: #6e45e2;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar-header h3 {
      font-size: 1.2rem;
      font-weight: 600;
    }
    .sidebar-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .sidebar-content {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    .sidebar-menu {
      list-style: none;
    }
    .sidebar-menu li {
      margin-bottom: 0.5rem;
    }
    .sidebar-menu a {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      color: #555;
      text-decoration: none;
      transition: all 0.3s;
    }
    .sidebar-menu a:hover, .sidebar-menu a.active {
      background: rgba(245, 247, 255, 0.7); /* Menos opaco para el hover, azulado */
      color: #6e45e2;
    }
    .sidebar-menu a i {
      width: 20px;
      text-align: center;
    }
    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid #eee;
      text-align: center;
    }
    .menu-toggle {
      position: fixed;
      top: 1rem;
      left: 1rem;
      background: #6e45e2;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 999;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }
    .menu-toggle:hover {
      transform: scale(1.1);
    }
    
    /* Overlay para menú */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    .overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .chat-container, .call-container {
        flex-direction: column;
        height: 70vh;
      }
      .chat-sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #ddd;
      }
      nav {
        gap: 0.5rem;
        padding: 0.5rem;
      }
      nav button {
        padding: 0.5rem 0.8rem;
        font-size: 0.9rem;
      }
      section {
        padding: 1.5rem;
      }
      .card-list {
        grid-template-columns: 1fr;
      }
      .profile-header {
        flex-direction: column;
      }
      .sidebar {
        width: 250px;
      }
    }
  </style>
</head>
<body>
  <div class="tech-bg"></div>

  <div class="menu-toggle" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
  </div>
  <div class="sidebar">
    <div class="sidebar-header">
      <h3><i class="fas fa-graduation-cap"></i> Collabu</h3>
      <button class="sidebar-close" onclick="toggleSidebar()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="sidebar-content">
      <ul class="sidebar-menu">
        <li><a href="#" onclick="showSection('dashboard')" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
        <li><a href="#" onclick="showSection('clubs')"><i class="fas fa-users"></i> Clubs</a></li>
        <li><a href="#" onclick="showSection('activities')"><i class="fas fa-star"></i> Actividades</a></li>
        <li><a href="#" onclick="showSection('collaborations')"><i class="fas fa-handshake"></i> Colaboraciones</a></li>
        <li><a href="#" onclick="showSection('network')"><i class="fas fa-network-wired"></i> Red Interinstitucional</a></li>
        <li><a href="#" onclick="showSection('chat')"><i class="fas fa-comments"></i> Chat</a></li>
        <li><a href="#" onclick="showSection('social')"><i class="fas fa-share-alt"></i> Red Social</a></li>
        <li><a href="#" onclick="showSection('calls')"><i class="fas fa-phone"></i> Llamadas</a></li>
        <li><a href="#" onclick="showSection('notes')"><i class="fas fa-sticky-note"></i> Mis Notas</a></li>
        <li><a href="#" onclick="showSection('profile')"><i class="fas fa-user"></i> Mi Perfil</a></li>
      </ul>
    </div>
    <div class="sidebar-footer">
      <button onclick="logout()" class="btn-primary" style="width: 100%;">
        <i class="fas fa-sign-out-alt"></i> Cerrar sesión
      </button>
    </div>
  </div>
  <div class="overlay" onclick="toggleSidebar()"></div>

  <div class="hero-image" id="login-hero">
    <img src="https://images.unsplash.com/photo-1571260899304-425eee4c7efc" alt="Estudiantes colaborando">
  </div>

  <div class="logo-container">
    <div class="logo"><i class="fas fa-graduation-cap"></i>Collabu</div>
    <div class="logo-subtitle">Plataforma Centralizada informativa y de interacción para Estudiantes de Educacion superior</div>
  </div>

  <section id="login-section" class="form-container active" aria-label="Sección de inicio de sesión">
    <div class="student-theme-bg"></div> <h2><i class="fas fa-sign-in-alt"></i> Iniciar sesión</h2>
    <form id="login-form" novalidate>
      <label for="login-username"><i class="fas fa-user"></i> Usuario</label>
      <input type="text" id="login-username" name="username" placeholder="Tu usuario" required autofocus />
      <label for="login-password"><i class="fas fa-lock"></i> Contraseña</label>
      <input type="password" id="login-password" name="password" placeholder="Tu contraseña" required />
      <button type="submit" class="btn-primary"><i class="fas fa-sign-in-alt"></i> Ingresar</button>
      <div id="error-message" aria-live="polite"></div>
    </form>
    <div class="form-link" id="show-register">¿No tienes cuenta? <strong>Regístrate</strong></div>
  </section>

  <section id="register-section" class="form-container" aria-label="Sección de registro de nuevos usuarios" style="display:none;">
    <div class="student-theme-bg"></div> <h2><i class="fas fa-user-plus"></i> Crear cuenta</h2>
    <form id="register-form" novalidate>
      <label for="register-username"><i class="fas fa-user"></i> Usuario</label>
      <input type="text" id="register-username" name="username" placeholder="Elige un usuario" required autofocus />
      <label for="register-password"><i class="fas fa-lock"></i> Contraseña</label>
      <input type="password" id="register-password" name="password" placeholder="Tu contraseña" required />
      <label for="register-password-confirm"><i class="fas fa-lock"></i> Confirmar contraseña</label>
      <input type="password" id="register-password-confirm" name="passwordConfirm" placeholder="Confirma tu contraseña" required />
      <div class="university-selector">
        <label for="register-university"><i class="fas fa-university"></i> Universidad</label>
        <select id="register-university" name="university" required>
          <option value="" disabled selected>Selecciona tu universidad</option>
          <option value="UPC">Universidad Peruana de Ciencias Aplicadas (UPC)</option>
          <option value="PUCP">Pontificia Universidad Católica del Perú (PUCP)</option>
          <option value="UNMSM">Universidad Nacional Mayor de San Marcos (UNMSM)</option>
          <option value="TECSUP">TECSUP</option>
          <option value="UTP">Universidad Tecnológica del Perú (UTP)</option>
          <option value="ULIMA">Universidad de Lima (ULIMA)</option>
          <option value="USIL">Universidad San Ignacio de Loyola (USIL)</option>
          <option value="UNI">Universidad Nacional de Ingeniería (UNI)</option>
        </select>
      </div>
      <button type="submit" class="btn-primary"><i class="fas fa-user-plus"></i> Registrarse</button>
      <div id="register-error-message" aria-live="polite"></div>
      <div id="success-message"></div>
    </form>
    <div class="form-link" id="show-login">¿Ya tienes cuenta? <strong>Inicia sesión</strong></div>
  </section>

  <div id="main-content" class="hidden">
    <header><i class="fas fa-graduation-cap"></i> Collabu</header>

    <main>
      <section id="dashboard" class="active">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-home"></i> Dashboard</h2>
        <div class="welcome-banner" style="background: linear-gradient(to right, #6e45e2, #88d3ce); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
          <h3 style="font-size: 2rem; margin-bottom: 0.5rem;"><i class="fas fa-hand-sparkles"></i> ¡Bienvenido a Collabu, <span id="dashboard-username"></span>!</h3>
          <p style="font-size: 1.1rem; opacity: 0.9;">Tu plataforma centralizada para el éxito académico y la conexión universitaria.</p>
        </div>
        <div class="card-list">
          <div class="card">
            <h3><i class="fas fa-users"></i> Mis Clubs</h3>
            <p>Explora y únete a clubs estudiantiles.</p>
            <button class="btn-primary" style="margin-top: 1rem; width: 100%;" onclick="showSection('clubs')"><i class="fas fa-arrow-right"></i> Ir a Clubs</button>
          </div>
          <div class="card">
            <h3><i class="fas fa-star"></i> Próximas Actividades</h3>
            <p>Descubre eventos y talleres.</p>
            <button class="btn-primary" style="margin-top: 1rem; width: 100%;" onclick="showSection('activities')"><i class="fas fa-arrow-right"></i> Ver Actividades</button>
          </div>
          <div class="card">
            <h3><i class="fas fa-comments"></i> Chat Rápido</h3>
            <p>Conéctate con tus compañeros al instante.</p>
            <button class="btn-primary" style="margin-top: 1rem; width: 100%;" onclick="showSection('chat')"><i class="fas fa-arrow-right"></i> Abrir Chat</button>
          </div>
          <div class="card">
            <h3><i class="fas fa-sticky-note"></i> Mis Notas</h3>
            <p>Organiza tus ideas y recordatorios.</p>
            <button class="btn-primary" style="margin-top: 1rem; width: 100%;" onclick="showSection('notes')"><i class="fas fa-arrow-right"></i> Ver Notas</button>
          </div>
        </div>
        <div class="news-feed" style="margin-top: 3rem;">
          <h3 style="color: #6e45e2; margin-bottom: 1.5rem;"><i class="fas fa-newspaper"></i> Últimas Noticias Universitarias</h3>
          <div class="card-list">
            <div class="card">
              <h3><i class="fas fa-bullhorn"></i> Convocatoria Hackatón 2024</h3>
              <p>Inscríbete en la Hackatón Interuniversitaria y demuestra tus habilidades.</p>
              <span class="university-badge" style="position: static; display: inline-block; margin-top: 1rem;">UPC</span>
            </div>
            <div class="card">
              <h3><i class="fas fa-calendar-alt"></i> Feria de Empleos PUCP</h3>
              <p>Oportunidades laborales y de prácticas para estudiantes de todas las carreras.</p>
              <span class="university-badge" style="position: static; display: inline-block; margin-top: 1rem;">PUCP</span>
            </div>
          </div>
        </div>
      </section>

      <section id="clubs">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-users"></i> Clubs Estudiantiles</h2>
        <div class="university-filter">
          <label for="club-university-filter"><i class="fas fa-filter"></i> Filtrar por Universidad:</label>
          <select id="club-university-filter" onchange="filterClubs()">
            <option value="all">Todas las Universidades</option>
            <option value="UPC">UPC</option>
            <option value="PUCP">PUCP</option>
            <option value="UNMSM">UNMSM</option>
            <option value="TECSUP">TECSUP</option>
            <option value="UTP">UTP</option>
            <option value="ULIMA">ULIMA</option>
            <option value="USIL">USIL</option>
            <option value="UNI">UNI</option>
          </select>
        </div>
        <div class="card-list" id="clubs-list">
          </div>
      </section>

      <section id="activities">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-star"></i> Próximas Actividades</h2>
        <div class="university-filter">
          <label for="activity-university-filter"><i class="fas fa-filter"></i> Filtrar por Universidad:</label>
          <select id="activity-university-filter" onchange="filterActivities()">
            <option value="all">Todas las Universidades</option>
            <option value="UPC">UPC</option>
            <option value="PUCP">PUCP</option>
            <option value="UNMSM">UNMSM</option>
            <option value="TECSUP">TECSUP</option>
            <option value="UTP">UTP</option>
            <option value="ULIMA">ULIMA</option>
            <option value="USIL">USIL</option>
            <option value="UNI">UNI</option>
          </select>
        </div>
        <div class="card-list" id="activities-list">
          </div>
      </section>

      <section id="collaborations">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-handshake"></i> Solicitudes de Colaboración</h2>
        <button class="btn-primary" style="margin-bottom: 1.5rem;" onclick="showCollaborationForm()"><i class="fas fa-plus-circle"></i> Nueva Solicitud</button>
        <div id="collaboration-form-container" class="form-container" style="display:none; max-width: 600px;">
            <div class="student-theme-bg"></div> <h3><i class="fas fa-plus-circle"></i> Crear Nueva Solicitud</h3>
          <form id="new-collaboration-form">
            <label for="collaboration-title">Título:</label>
            <input type="text" id="collaboration-title" required>
            <label for="collaboration-description">Descripción:</label>
            <textarea id="collaboration-description" rows="4" required></textarea>
            <label for="collaboration-skills">Habilidades Requeridas (separadas por comas):</label>
            <input type="text" id="collaboration-skills" placeholder="Ej: Python, Diseño UX, Marketing">
            <label for="collaboration-contact">Contacto:</label>
            <input type="text" id="collaboration-contact" required>
            <button type="submit" class="btn-primary"><i class="fas fa-paper-plane"></i> Enviar Solicitud</button>
          </form>
        </div>
        <div class="card-list" id="collaborations-list">
          </div>
      </section>

      <section id="network">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-network-wired"></i> Red Interinstitucional</h2>
        <p>Conéctate con estudiantes de otras universidades para proyectos y eventos.</p>
        <div class="university-filter">
          <label for="network-university-filter"><i class="fas fa-filter"></i> Filtrar por Universidad:</label>
          <select id="network-university-filter" onchange="filterNetwork()">
            <option value="all">Todas las Universidades</option>
            <option value="UPC">UPC</option>
            <option value="PUCP">PUCP</option>
            <option value="UNMSM">UNMSM</option>
            <option value="TECSUP">TECSUP</option>
            <option value="UTP">UTP</option>
            <option value="ULIMA">ULIMA</option>
            <option value="USIL">USIL</option>
            <option value="UNI">UNI</option>
          </select>
        </div>
        <div class="card-list" id="network-list">
          </div>
      </section>

      <section id="chat">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-comments"></i> Chat</h2>
        <div class="chat-container">
          <div class="chat-sidebar">
            <div class="chat-tabs">
              <div class="chat-tab active" onclick="showChatContacts('individual')"><i class="fas fa-user"></i> Individual</div>
              <div class="chat-tab" onclick="showChatContacts('group')"><i class="fas fa-users"></i> Grupos</div>
            </div>
            <div class="chat-contacts" id="chat-individual-contacts">
              </div>
            <div class="chat-contacts" id="chat-group-contacts" style="display:none;">
              </div>
          </div>
          <div class="chat-main">
            <div class="chat-header">
              <i class="fas fa-user-circle"></i> <span id="current-chat-name">Selecciona un contacto</span>
            </div>
            <div class="chat-messages" id="chat-messages">
              </div>
            <div class="chat-input">
              <input type="text" id="message-input" placeholder="Escribe un mensaje..." />
              <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i> Enviar</button>
            </div>
          </div>
        </div>
      </section>

      <section id="social">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-share-alt"></i> Red Social Universitaria</h2>
        <div class="social-post-form" style="background: rgba(245, 247, 255, 0.8); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);">
          <h3><i class="fas fa-plus-square"></i> Crear Nueva Publicación</h3>
          <form id="social-post-form">
            <textarea id="post-text" placeholder="¿Qué estás pensando hoy?" rows="3" style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 1rem; background: rgba(255,255,255,0.9);"></textarea>
            <label for="post-image" class="btn-primary" style="display: block; text-align: center; margin-bottom: 1rem; cursor: pointer;"><i class="fas fa-image"></i> Añadir Imagen (Opcional)</label>
            <input type="file" id="post-image" accept="image/*" style="display: none;">
            <button type="submit" class="btn-primary"><i class="fas fa-paper-plane"></i> Publicar</button>
          </form>
        </div>
        <div class="social-feed" id="social-feed">
          <div class="post-example" style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: rgba(233, 240, 255, 0.9);">
            <p><strong>UsuarioEjemplo1</strong> <em style='color:#888'>2024-06-26 10:30 AM</em></p>
            <p>¡Emocionado por el nuevo proyecto en el club de programación!</p>
          </div>
          <div class="post-example" style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: rgba(233, 240, 255, 0.9);">
            <p><strong>EstudianteCollabu</strong> <em style='color:#888'>2024-06-25 03:15 PM</em></p>
            <p>Recuerden la reunión del grupo de estudio de física mañana a las 9 AM.</p>
            <img src="https://via.placeholder.com/400x200.png?text=Reunion+de+Estudio" style="max-width: 100%; margin-top: 1rem; border-radius: 8px;" />
          </div>
        </div>
      </section>

      <section id="calls">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-phone"></i> Llamadas</h2>
        <div class="call-container">
          <div class="call-header">
            <i class="fas fa-video"></i> Videollamada
          </div>
          <div class="call-video">
            <video id="local-video" autoplay muted style="width: 48%; border: 2px solid #6e45e2; border-radius: 8px;"></video>
            <video id="remote-video" autoplay style="width: 48%; border: 2px solid #88d3ce; border-radius: 8px; margin-left: 1%;"></video>
          </div>
          <div class="call-controls">
            <button id="start-call-btn" onclick="startCall()"><i class="fas fa-phone-alt"></i> Iniciar Llamada</button>
            <button id="end-call-btn" class="end-call" onclick="endCall()"><i class="fas fa-phone-slash"></i> Terminar Llamada</button>
            <button id="toggle-video-btn" onclick="toggleVideo()"><i class="fas fa-video"></i></button>
            <button id="toggle-audio-btn" onclick="toggleAudio()"><i class="fas fa-microphone"></i></button>
          </div>
        </div>
      </section>

      <section id="notes">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-sticky-note"></i> Mis Notas</h2>
        <div class="note-form">
          <h3><i class="fas fa-plus-circle"></i> Crear Nueva Nota</h3>
          <form id="new-note-form">
            <label for="note-title">Título:</label>
            <input type="text" id="note-title" required>
            <label for="note-content">Contenido:</label>
            <textarea id="note-content" rows="6" required></textarea>
            <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Guardar Nota</button>
          </form>
        </div>
        <div class="notes-container">
          <h3 style="color: #6e45e2; margin-top: 2rem; margin-bottom: 1.5rem;"><i class="fas fa-list-alt"></i> Mis Notas Guardadas</h3>
          <div class="notes-list" id="notes-list">
            <div class="note-card">
              <h4>Recordatorio de Proyecto</h4>
              <p>Reunión final del proyecto de base de datos el viernes a las 3 PM en el laboratorio 5.</p>
              <span class="note-date"><i class="fas fa-calendar-alt"></i> 2024-06-24</span>
              <button class="delete-note"><i class="fas fa-trash-alt"></i></button>
            </div>
            <div class="note-card">
              <h4>Ideas para el Hackatón</h4>
              <p>Desarrollar una aplicación de gestión de tareas colaborativa con integración de calendario.</p>
              <span class="note-date"><i class="fas fa-calendar-alt"></i> 2024-06-22</span>
              <button class="delete-note"><i class="fas fa-trash-alt"></i></button>
            </div>
          </div>
        </div>
      </section>

      <section id="profile">
        <div class="student-theme-bg"></div> <h2><i class="fas fa-user"></i> Mi Perfil</h2>
        <div class="profile-container">
          <div class="profile-header">
            <div class="profile-avatar" onclick="openAvatarSelector()">
              <img id="profile-avatar-img" src="https://via.placeholder.com/120/6e45e2/ffffff?text=U" alt="Avatar de Usuario">
              <div class="change-avatar"><i class="fas fa-camera"></i> Cambiar</div>
            </div>
            <div class="profile-info">
              <h3 class="profile-name" id="profile-username-display">Nombre de Usuario</h3>
              <p class="profile-university"><i class="fas fa-university"></i> <span id="profile-university-display">Universidad</span></p>
            </div>
          </div>

          <div class="profile-section">
            <h3><i class="fas fa-info-circle"></i> Información Personal</h3>
            <p><strong>Email:</strong> <span id="profile-email">usuario@example.com</span></p>
            <p><strong>Intereses:</strong> <span id="profile-interests">Programación, Diseño, Marketing Digital</span></p>
            <p><strong>Habilidades:</strong> <span id="profile-skills">JavaScript, Python, Photoshop</span></p>
            <div class="profile-edit">
              <button onclick="editProfile()"><i class="fas fa-edit"></i> Editar Perfil</button>
            </div>
          </div>
          
          <div id="edit-profile-form-container" class="form-container" style="display:none; max-width: 100%;">
            <div class="student-theme-bg"></div> <h3><i class="fas fa-edit"></i> Editar Información de Perfil</h3>
            <form id="edit-profile-form">
              <label for="edit-email">Email:</label>
              <input type="email" id="edit-email">
              <label for="edit-interests">Intereses (separados por comas):</label>
              <input type="text" id="edit-interests">
              <label for="edit-skills">Habilidades (separadas por comas):</label>
              <input type="text" id="edit-skills">
              <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Guardar Cambios</button>
            </form>
          </div>

          <div class="profile-section" style="margin-top: 1.5rem;">
            <h3><i class="fas fa-calendar-alt"></i> Mis Actividades Recientes</h3>
            <ul id="profile-recent-activities" style="list-style: none; padding-left: 0;">
              <li><i class="fas fa-check-circle" style="color: #2ed573; margin-right: 0.5rem;"></i> Participó en el "Taller de Desarrollo Web" (hace 2 días)</li>
              <li><i class="fas fa-check-circle" style="color: #2ed573; margin-right: 0.5rem;"></i> Se unió al club de "Robótica Avanzada" (hace 1 semana)</li>
              <li><i class="fas fa-check-circle" style="color: #2ed573; margin-right: 0.5rem;"></i> Completó el curso "Introducción a la IA" (hace 3 semanas)</li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="avatar-selector" id="avatar-selector">
    <div class="avatar-selector-content">
        <div class="student-theme-bg"></div> <h3 class="avatar-selector-title"><i class="fas fa-image"></i> Selecciona un Avatar o Sube uno Nuevo</h3>
      <div class="avatar-grid" id="avatar-grid">
        <div class="avatar-option" data-avatar-url="https://i.ibb.co/VMyh8QY/avatar1.png"><img src="https://i.ibb.co/VMyh8QY/avatar1.png" alt="Avatar 1"></div>
        <div class="avatar-option" data-avatar-url="https://i.ibb.co/QjF02f2/avatar2.png"><img src="https://i.ibb.co/QjF02f2/avatar2.png" alt="Avatar 2"></div>
        <div class="avatar-option" data-avatar-url="https://i.ibb.co/vQNp4fT/avatar3.png"><img src="https://i.ibb.co/vQNp4fT/avatar3.png" alt="Avatar 3"></div>
        <div class="avatar-option" data-avatar-url="https://i.ibb.co/q70k05F/avatar4.png"><img src="https://i.ibb.co/q70k05F/avatar4.png" alt="Avatar 4"></div>
        <div class="avatar-option" data-avatar-url="https://i.ibb.co/R2W7JqP/avatar5.png"><img src="https://i.ibb.co/R2W7JqP/avatar5.png" alt="Avatar 5"></div>
        <div class="avatar-option" data-avatar-url="https://i.ibb.co/g313X1Q/avatar6.png"><img src="https://i.ibb.co/g313X1Q/avatar6.png" alt="Avatar 6"></div>
      </div>
      <label for="custom-avatar-upload" class="btn-primary" style="display: block; text-align: center; margin-bottom: 1rem; cursor: pointer;"><i class="fas fa-upload"></i> Subir Avatar Personalizado</label>
      <input type="file" id="custom-avatar-upload" accept="image/*" style="display: none;">
      <div class="avatar-selector-buttons">
        <button class="confirm" onclick="applyAvatar()"><i class="fas fa-check-circle"></i> Aplicar</button>
        <button class="cancel" onclick="closeAvatarSelector()"><i class="fas fa-times-circle"></i> Cancelar</button>
      </div>
    </div>
  </div>


<script>
  // Simulación de base de datos de usuarios
  let users = JSON.parse(localStorage.getItem('users')) || [];
  let currentUser = JSON.parse(sessionStorage.getItem('currentUser'));

  // Estado de UI
  const loginSection = document.getElementById('login-section');
  const registerSection = document.getElementById('register-section');
  const mainContent = document.getElementById('main-content');
  const dashboardUsername = document.getElementById('dashboard-username');
  const profileUsernameDisplay = document.getElementById('profile-username-display');
  const profileUniversityDisplay = document.getElementById('profile-university-display');
  const profileEmail = document.getElementById('profile-email');
  const profileInterests = document.getElementById('profile-interests');
  const profileSkills = document.getElementById('profile-skills');
  const profileAvatarImg = document.getElementById('profile-avatar-img');
  const heroImage = document.getElementById('login-hero');
  const logoContainer = document.querySelector('.logo-container');
  const menuToggle = document.querySelector('.menu-toggle');
  const sidebar = document.querySelector('.sidebar');
  const overlay = document.querySelector('.overlay');

  // Funciones de utilidad
  function showMessage(elementId, message, isError = true) {
    const element = document.getElementById(elementId);
    element.textContent = message;
    element.style.display = 'block';
    element.style.color = isError ? '#ff4757' : '#2ed573';
    element.style.background = isError ? 'rgba(255, 71, 87, 0.1)' : 'rgba(46, 213, 115, 0.1)';
  }

  function hideMessage(elementId) {
    document.getElementById(elementId).style.display = 'none';
  }

  // Funciones de Autenticación
  function checkSession() {
    if (currentUser) {
      loginSection.style.display = 'none';
      registerSection.style.display = 'none';
      heroImage.style.display = 'none';
      logoContainer.style.display = 'none';
      mainContent.classList.remove('hidden');
      menuToggle.style.display = 'flex';
      updateDashboardAndProfile();
      showSection('dashboard'); // Mostrar dashboard por defecto al iniciar sesión
    } else {
      loginSection.style.display = 'flex';
      registerSection.style.display = 'none';
      heroImage.style.display = 'block';
      logoContainer.style.display = 'block';
      mainContent.classList.add('hidden');
      menuToggle.style.display = 'none';
      // Reiniciar secciones activas en el menú lateral
      document.querySelectorAll('.sidebar-menu a').forEach(link => link.classList.remove('active'));
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
    }
  }

  function login(username, password) {
    hideMessage('error-message');
    const user = users.find(u => u.username === username && u.password === password);
    if (user) {
      currentUser = user;
      sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
      checkSession();
    } else {
      showMessage('error-message', 'Usuario o contraseña incorrectos.');
    }
  }

  function register(username, password, passwordConfirm, university) {
    hideMessage('register-error-message');
    hideMessage('success-message');

    if (password !== passwordConfirm) {
      showMessage('register-error-message', 'Las contraseñas no coinciden.');
      return;
    }
    if (users.some(u => u.username === username)) {
      showMessage('register-error-message', 'El nombre de usuario ya existe.');
      return;
    }

    const newUser = {
      username,
      password,
      university,
      avatar: 'https://via.placeholder.com/120/6e45e2/ffffff?text=U', // Default avatar
      email: '',
      interests: '',
      skills: ''
    };
    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));
    showMessage('success-message', 'Registro exitoso. ¡Ahora puedes iniciar sesión!', false);
    document.getElementById('register-form').reset();
    showLogin();
  }

  function logout() {
    currentUser = null;
    sessionStorage.removeItem('currentUser');
    checkSession();
    toggleSidebar(); // Cerrar sidebar si está abierto
  }

  // Manejadores de eventos de formularios de autenticación
  document.getElementById('login-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    login(username, password);
  });

  document.getElementById('register-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const username = document.getElementById('register-username').value;
    const password = document.getElementById('register-password').value;
    const passwordConfirm = document.getElementById('register-password-confirm').value;
    const university = document.getElementById('register-university').value;
    register(username, password, passwordConfirm, university);
  });

  document.getElementById('show-register').addEventListener('click', function() {
    loginSection.style.display = 'none';
    registerSection.style.display = 'flex';
    heroImage.style.display = 'none';
    logoContainer.style.display = 'none';
  });

  document.getElementById('show-login').addEventListener('click', function() {
    showLogin();
  });

  function showLogin() {
    registerSection.style.display = 'none';
    loginSection.style.display = 'flex';
    heroImage.style.display = 'block';
    logoContainer.style.display = 'block';
    hideMessage('register-error-message');
    hideMessage('success-message');
  }

  // Funciones de navegación y UI principal
  function toggleSidebar() {
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
  }

  function showSection(sectionId) {
    document.querySelectorAll('section').forEach(section => {
      section.classList.remove('active');
    });
    document.getElementById(sectionId).classList.add('active');

    document.querySelectorAll('.sidebar-menu a').forEach(link => {
      link.classList.remove('active');
    });
    document.querySelector(`.sidebar-menu a[onclick="showSection('${sectionId}')"]`).classList.add('active');

    if (sectionId === 'profile') {
      updateProfileData();
    }
    toggleSidebar(); // Cerrar sidebar después de seleccionar una sección
  }

  function updateDashboardAndProfile() {
    if (currentUser) {
      dashboardUsername.textContent = currentUser.username;
      profileUsernameDisplay.textContent = currentUser.username;
      profileUniversityDisplay.textContent = currentUser.university;
      profileEmail.textContent = currentUser.email || 'N/A';
      profileInterests.textContent = currentUser.interests || 'N/A';
      profileSkills.textContent = currentUser.skills || 'N/A';
      profileAvatarImg.src = currentUser.avatar;

      // Set values for edit profile form
      document.getElementById('edit-email').value = currentUser.email || '';
      document.getElementById('edit-interests').value = currentUser.interests || '';
      document.getElementById('edit-skills').value = currentUser.skills || '';
    }
  }

  function updateProfileData() {
    profileUsernameDisplay.textContent = currentUser.username;
    profileUniversityDisplay.textContent = currentUser.university;
    profileEmail.textContent = currentUser.email || 'N/A';
    profileInterests.textContent = currentUser.interests || 'N/A';
    profileSkills.textContent = currentUser.skills || 'N/A';
    profileAvatarImg.src = currentUser.avatar;

    document.getElementById('edit-email').value = currentUser.email || '';
    document.getElementById('edit-interests').value = currentUser.interests || '';
    document.getElementById('edit-skills').value = currentUser.skills || '';
  }

  function editProfile() {
    const editFormContainer = document.getElementById('edit-profile-form-container');
    editFormContainer.style.display = editFormContainer.style.display === 'none' ? 'flex' : 'none';
  }

  document.getElementById('edit-profile-form').addEventListener('submit', function(event) {
    event.preventDefault();
    currentUser.email = document.getElementById('edit-email').value;
    currentUser.interests = document.getElementById('edit-interests').value;
    currentUser.skills = document.getElementById('edit-skills').value;

    // Update users array in localStorage
    const userIndex = users.findIndex(u => u.username === currentUser.username);
    if (userIndex !== -1) {
      users[userIndex] = currentUser;
      localStorage.setItem('users', JSON.stringify(users));
      sessionStorage.setItem('currentUser', JSON.stringify(currentUser)); // Update session storage as well
    }
    updateProfileData();
    editProfile(); // Hide form after saving
  });

  // Funcionalidad de Avatar
  const avatarSelector = document.getElementById('avatar-selector');
  let selectedAvatar = currentUser ? currentUser.avatar : 'https://via.placeholder.com/120/6e45e2/ffffff?text=U'; // Initial selection

  function openAvatarSelector() {
    avatarSelector.classList.add('active');
    document.querySelectorAll('.avatar-option').forEach(option => {
      option.classList.remove('selected');
      if (option.dataset.avatarUrl === selectedAvatar) {
        option.classList.add('selected');
      }
    });
  }

  function closeAvatarSelector() {
    avatarSelector.classList.remove('active');
  }

  document.getElementById('avatar-grid').addEventListener('click', function(event) {
    const target = event.target.closest('.avatar-option');
    if (target) {
      document.querySelectorAll('.avatar-option').forEach(option => option.classList.remove('selected'));
      target.classList.add('selected');
      selectedAvatar = target.dataset.avatarUrl;
    }
  });

  document.getElementById('custom-avatar-upload').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        selectedAvatar = e.target.result;
        // Create a temporary selected avatar element to show the uploaded one
        const tempAvatarOption = document.createElement('div');
        tempAvatarOption.classList.add('avatar-option', 'selected');
        tempAvatarOption.innerHTML = `<img src="${selectedAvatar}" alt="Custom Avatar">`;
        document.querySelectorAll('.avatar-option').forEach(option => option.classList.remove('selected'));
        document.getElementById('avatar-grid').prepend(tempAvatarOption); // Add to the beginning
      };
      reader.readAsDataURL(file);
    }
  });

  function applyAvatar() {
    if (currentUser) {
      currentUser.avatar = selectedAvatar;
      profileAvatarImg.src = selectedAvatar;

      // Update users array in localStorage
      const userIndex = users.findIndex(u => u.username === currentUser.username);
      if (userIndex !== -1) {
        users[userIndex] = currentUser;
        localStorage.setItem('users', JSON.stringify(users));
        sessionStorage.setItem('currentUser', JSON.stringify(currentUser)); // Update session storage as well
      }
      closeAvatarSelector();
    }
  }

  // Data simulación para el resto de secciones
  const clubsData = [
    { name: "Club de Programación", description: "Enfocado en desarrollo de software y algoritmos.", university: "UPC", icon: "fas fa-laptop-code" },
    { name: "Club de Robótica", description: "Diseño y construcción de robots autónomos.", university: "PUCP", icon: "fas fa-robot" },
    { name: "Círculo de Estudios de Matemáticas", description: "Refuerzo y resolución de problemas avanzados.", university: "UNMSM", icon: "fas fa-calculator" },
    { name: "Club de Debate", description: "Mejora tus habilidades de oratoria y argumentación.", university: "UTP", icon: "fas fa-comments" },
    { name: "Club de Marketing Digital", description: "Estrategias de marketing online y redes sociales.", university: "ULIMA", icon: "fas fa-chart-line" },
    { name: "Club de Emprendimiento", description: "Desarrollo de ideas de negocio y startups.", university: "USIL", icon: "fas fa-lightbulb" }
  ];

  const activitiesData = [
    { name: "Taller de Desarrollo Web", description: "Aprende HTML, CSS y JavaScript desde cero.", university: "UPC", date: "2024-07-10", icon: "fas fa-code" },
    { name: "Hackatón Interuniversitario", description: "Competición de desarrollo de software intensiva.", university: "PUCP", date: "2024-08-05", icon: "fas fa-trophy" },
    { name: "Charla de Inteligencia Artificial", description: "Descubre los avances y aplicaciones de la IA.", university: "UNMSM", date: "2024-07-20", icon: "fas fa-brain" },
    { name: "Feria de Proyectos de Ingeniería", description: "Exposición de proyectos innovadores de ingeniería.", university: "UNI", date: "2024-09-01", icon: "fas fa-flask" }
  ];

  const collaborationsData = []; // Se llenará dinámicamente

  const networkProfilesData = [
    { name: "Ana Torres", university: "PUCP", interests: "Diseño UX, Gestión de Proyectos", skills: "Figma, Scrum" },
    { name: "Carlos Soto", university: "UNI", interests: "Inteligencia Artificial, Data Science", skills: "Python, Machine Learning" },
    { name: "Luisa Mendoza", university: "ULIMA", interests: "Marketing Digital, Contenido", skills: "SEO, Redes Sociales" },
  ];

  const chatContacts = [
    { name: "Juan Perez", university: "UPC", type: "individual" },
    { name: "Maria Lopez", university: "PUCP", type: "individual" },
    { name: "Grupo de Proyecto X", university: "UPC", type: "group" },
    { name: "Club de Robótica", university: "UNMSM", type: "group" }
  ];

  const chatMessages = {}; // Almacena mensajes por contacto

  // Funciones de carga y filtrado de contenido
  function loadClubs(filter = 'all') {
    const list = document.getElementById('clubs-list');
    list.innerHTML = '';
    const filteredClubs = filter === 'all' ? clubsData : clubsData.filter(club => club.university === filter);
    filteredClubs.forEach(club => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h3><i class="${club.icon}"></i> ${club.name}</h3>
        <p>${club.description}</p>
        <span class="university-badge">${club.university}</span>
        <button class="btn-primary" style="margin-top: 1rem; width: 100%;"><i class="fas fa-plus-circle"></i> Unirse</button>
      `;
      list.appendChild(card);
    });
  }

  function filterClubs() {
    loadClubs(document.getElementById('club-university-filter').value);
  }

  function loadActivities(filter = 'all') {
    const list = document.getElementById('activities-list');
    list.innerHTML = '';
    const filteredActivities = filter === 'all' ? activitiesData : activitiesData.filter(activity => activity.university === filter);
    filteredActivities.forEach(activity => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h3><i class="${activity.icon}"></i> ${activity.name}</h3>
        <p>${activity.description}</p>
        <p><i class="fas fa-calendar-alt"></i> ${activity.date}</p>
        <span class="university-badge">${activity.university}</span>
        <button class="btn-primary" style="margin-top: 1rem; width: 100%;"><i class="fas fa-info-circle"></i> Más info</button>
      `;
      list.appendChild(card);
    });
  }

  function filterActivities() {
    loadActivities(document.getElementById('activity-university-filter').value);
  }

  function showCollaborationForm() {
    document.getElementById('collaboration-form-container').style.display = 'flex';
  }

  document.getElementById('new-collaboration-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const title = document.getElementById('collaboration-title').value;
    const description = document.getElementById('collaboration-description').value;
    const skills = document.getElementById('collaboration-skills').value;
    const contact = document.getElementById('collaboration-contact').value;

    const newCollaboration = {
      title,
      description,
      skills,
      contact,
      author: currentUser.username,
      university: currentUser.university,
      date: new Date().toLocaleDateString()
    };
    collaborationsData.push(newCollaboration);
    localStorage.setItem('collaborations', JSON.stringify(collaborationsData)); // Guardar en localStorage
    loadCollaborations();
    document.getElementById('new-collaboration-form').reset();
    document.getElementById('collaboration-form-container').style.display = 'none';
  });

  function loadCollaborations() {
    const list = document.getElementById('collaborations-list');
    list.innerHTML = '';
    const storedCollaborations = JSON.parse(localStorage.getItem('collaborations')) || [];
    collaborationsData.splice(0, collaborationsData.length, ...storedCollaborations); // Sincronizar con localStorage

    if (collaborationsData.length === 0) {
      list.innerHTML = '<p style="text-align: center; color: #888; margin-top: 2rem;">No hay solicitudes de colaboración disponibles.</p>';
      return;
    }

    collaborationsData.forEach(collab => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h3><i class="fas fa-handshake"></i> ${collab.title}</h3>
        <p>${collab.description}</p>
        <p><strong>Habilidades:</strong> ${collab.skills}</p>
        <p><strong>Contacto:</strong> ${collab.contact}</p>
        <p><small>Publicado por ${collab.author} de ${collab.university} el ${collab.date}</small></p>
        <button class="btn-primary" style="margin-top: 1rem; width: 100%;"><i class="fas fa-reply"></i> Contactar</button>
      `;
      list.appendChild(card);
    });
  }

  function loadNetworkProfiles(filter = 'all') {
    const list = document.getElementById('network-list');
    list.innerHTML = '';
    const filteredProfiles = filter === 'all' ? networkProfilesData : networkProfilesData.filter(profile => profile.university === filter);
    filteredProfiles.forEach(profile => {
      const card = document.createElement('div');
      card.className = 'card interclub-card';
      card.innerHTML = `
        <h3><i class="fas fa-user-circle"></i> ${profile.name}</h3>
        <p><strong>Intereses:</strong> ${profile.interests}</p>
        <p><strong>Habilidades:</strong> ${profile.skills}</p>
        <span class="university-badge">${profile.university}</span>
        <button class="btn-primary" style="margin-top: 1rem; width: 100%;"><i class="fas fa-user-plus"></i> Conectar</button>
      `;
      list.appendChild(card);
    });
  }

  function filterNetwork() {
    loadNetworkProfiles(document.getElementById('network-university-filter').value);
  }

  function showChatContacts(type) {
    document.querySelectorAll('.chat-contacts').forEach(contactList => contactList.style.display = 'none');
    document.querySelectorAll('.chat-tab').forEach(tab => tab.classList.remove('active'));

    if (type === 'individual') {
      document.getElementById('chat-individual-contacts').style.display = 'block';
      document.querySelector('.chat-tab:nth-child(1)').classList.add('active');
    } else {
      document.getElementById('chat-group-contacts').style.display = 'block';
      document.querySelector('.chat-tab:nth-child(2)').classList.add('active');
    }
    loadChatContacts(type);
  }

  function loadChatContacts(type) {
    const individualList = document.getElementById('chat-individual-contacts');
    const groupList = document.getElementById('chat-group-contacts');
    individualList.innerHTML = '';
    groupList.innerHTML = '';

    chatContacts.forEach(contact => {
      const contactElement = document.createElement('div');
      contactElement.className = 'chat-contact';
      contactElement.innerHTML = `
        <span class="chat-contact-name"><i class="fas fa-user-circle"></i> ${contact.name}</span>
        <span class="chat-contact-university"><i class="fas fa-university"></i> ${contact.university}</span>
      `;
      contactElement.onclick = () => selectChat(contact.name);
      if (contact.type === 'individual') {
        individualList.appendChild(contactElement);
      } else {
        groupList.appendChild(contactElement);
      }
    });
  }

  function selectChat(contactName) {
    document.getElementById('current-chat-name').textContent = contactName;
    document.querySelectorAll('.chat-contact').forEach(contact => contact.classList.remove('active'));
    // Find and set active class (this is simplified, needs better identification for real app)
    const activeContact = Array.from(document.querySelectorAll('.chat-contact')).find(c => c.textContent.includes(contactName));
    if (activeContact) {
      activeContact.classList.add('active');
    }

    // Load messages for this chat
    const messagesContainer = document.getElementById('chat-messages');
    messagesContainer.innerHTML = '';
    if (!chatMessages[contactName]) {
      chatMessages[contactName] = []; // Initialize if no messages exist
    }
    chatMessages[contactName].forEach(msg => displayMessage(msg.sender, msg.text, msg.time, msg.type));
    messagesContainer.scrollTop = messagesContainer.scrollHeight; // Scroll to bottom
  }

  function displayMessage(sender, text, time, type) {
    const messagesContainer = document.getElementById('chat-messages');
    const messageElement = document.createElement('div');
    messageElement.className = `message ${type}`;
    messageElement.innerHTML = `
      <div class="message-sender">${sender}</div>
      <div class="message-text">${text}</div>
      <div class="message-time">${time}</div>
    `;
    messagesContainer.appendChild(messageElement);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  function sendMessage() {
    const messageInput = document.getElementById('message-input');
    const messageText = messageInput.value.trim();
    const currentChat = document.getElementById('current-chat-name').textContent;

    if (messageText && currentChat !== 'Selecciona un contacto') {
      const now = new Date();
      const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const newMessage = {
        sender: currentUser.username,
        text: messageText,
        time: time,
        type: 'sent'
      };
      if (!chatMessages[currentChat]) {
        chatMessages[currentChat] = [];
      }
      chatMessages[currentChat].push(newMessage);
      displayMessage(newMessage.sender, newMessage.text, newMessage.time, newMessage.type);
      messageInput.value = '';
    } else if (!messageText) {
      alert("Por favor, escribe un mensaje.");
    } else {
      alert("Por favor, selecciona un contacto o grupo para chatear.");
    }
  }


  // Funcionalidad de Llamadas (simulada)
  let localStream;
  let peerConnection;
  const localVideo = document.getElementById('local-video');
  const remoteVideo = document.getElementById('remote-video');

  const configuration = {
    iceServers: [
      { urls: 'stun:stun.l.google.com:19302' } // Google's public STUN server
    ]
  };

  async function startCall() {
    try {
      localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      localVideo.srcObject = localStream;

      peerConnection = new RTCPeerConnection(configuration);

      localStream.getTracks().forEach(track => {
        peerConnection.addTrack(track, localStream);
      });

      peerConnection.ontrack = (event) => {
        remoteVideo.srcObject = event.streams[0];
      };

      peerConnection.onicecandidate = (event) => {
        if (event.candidate) {
          // Send candidate to remote peer (signaling server needed for real app)
          console.log('ICE Candidate:', event.candidate);
        }
      };

      const offer = await peerConnection.createOffer();
      await peerConnection.setLocalDescription(offer);
      // Send offer to remote peer (signaling server needed for real app)
      console.log('SDP Offer:', offer.sdp);

      alert('Llamada iniciada. Esperando al otro participante (funcionalidad P2P simulada). En una aplicación real, necesitarías un servidor de señalización para conectar a los usuarios.');

    } catch (error) {
      console.error('Error al iniciar la llamada:', error);
      alert('Error al iniciar la llamada. Asegúrate de permitir el acceso a tu cámara y micrófono.');
    }
  }

  function endCall() {
    if (localStream) {
      localStream.getTracks().forEach(track => track.stop());
    }
    if (peerConnection) {
      peerConnection.close();
    }
    localVideo.srcObject = null;
    remoteVideo.srcObject = null;
    alert('Llamada terminada.');
  }

  function toggleVideo() {
    localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled;
    const icon = document.querySelector('#toggle-video-btn i');
    if (localStream.getVideoTracks()[0].enabled) {
      icon.classList.replace('fa-video-slash', 'fa-video');
    } else {
      icon.classList.replace('fa-video', 'fa-video-slash');
    }
  }

  function toggleAudio() {
    localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;
    const icon = document.querySelector('#toggle-audio-btn i');
    if (localStream.getAudioTracks()[0].enabled) {
      icon.classList.replace('fa-microphone-slash', 'fa-microphone');
    } else {
      icon.classList.replace('fa-microphone', 'fa-microphone-slash');
    }
  }

  // Funcionalidad de Notas
  let notes = JSON.parse(localStorage.getItem('notes')) || [];

  function saveNote(title, content) {
    const newNote = {
      id: Date.now(),
      title,
      content,
      date: new Date().toLocaleDateString()
    };
    notes.push(newNote);
    localStorage.setItem('notes', JSON.stringify(notes));
    loadNotes();
  }

  function deleteNote(id) {
    notes = notes.filter(note => note.id !== id);
    localStorage.setItem('notes', JSON.stringify(notes));
    loadNotes();
  }

  function loadNotes() {
    const list = document.getElementById('notes-list');
    list.innerHTML = '';
    if (notes.length === 0) {
      list.innerHTML = '<p style="text-align: center; color: #888; margin-top: 2rem;">No tienes notas guardadas.</p>';
      return;
    }
    notes.forEach(note => {
      const noteCard = document.createElement('div');
      noteCard.className = 'note-card';
      noteCard.innerHTML = `
        <h4>${note.title}</h4>
        <p>${note.content}</p>
        <span class="note-date"><i class="fas fa-calendar-alt"></i> ${note.date}</span>
        <button class="delete-note" data-id="${note.id}"><i class="fas fa-trash-alt"></i></button>
      `;
      list.appendChild(noteCard);
    });

    document.querySelectorAll('.delete-note').forEach(button => {
      button.addEventListener('click', (e) => {
        const noteId = parseInt(e.currentTarget.dataset.id);
        deleteNote(noteId);
      });
    });
  }

  document.getElementById('new-note-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const title = document.getElementById('note-title').value;
    const content = document.getElementById('note-content').value;
    if (title && content) {
      saveNote(title, content);
      document.getElementById('new-note-form').reset();
    } else {
      alert('Por favor, ingresa un título y contenido para la nota.');
    }
  });

  // Funcionalidad de Red Social
  const socialFeed = document.getElementById('social-feed');

  document.getElementById('social-post-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const text = document.getElementById('post-text').value.trim();
    const imageFile = document.getElementById('post-image').files[0];

    if (!text && !imageFile) {
      alert("Escribe algo o añade una imagen.");
      return;
    }

    const postElement = document.createElement("div");
    postElement.style.border = "1px solid #ddd";
    postElement.style.borderRadius = "8px";
    postElement.style.padding = "1rem";
    postElement.style.marginBottom = "1rem";
    postElement.style.background = "rgba(233, 240, 255, 0.9)"; // Fondo semi-transparente para posts

    const now = new Date();
    let content = `<p><strong>${currentUser.username}</strong> <em style='color:#888'>${now.toLocaleString()}</em></p>`;
    content += `<p>${text}</p>`;

    if (imageFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        content += `<img src=\"${e.target.result}\" style=\"max-width: 100%; margin-top: 1rem; border-radius: 8px;\" />`;
        postElement.innerHTML = content;
        socialFeed.prepend(postElement);
      };
      reader.readAsDataURL(imageFile);
    } else {
      postElement.innerHTML = content;
      socialFeed.prepend(postElement);
    }

    document.getElementById("social-post-form").reset();
  });


  // Inicialización
  document.addEventListener('DOMContentLoaded', () => {
    checkSession();
    loadClubs();
    loadActivities();
    loadCollaborations();
    loadNetworkProfiles();
    loadChatContacts('individual');
    loadNotes();
  });
</script>

</body>
</html>